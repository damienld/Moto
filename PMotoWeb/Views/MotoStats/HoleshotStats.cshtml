@model PMotoWeb.ViewModels.MotoStatsViewModel
@{
    ViewBag.Title = "Races Stats";
}
@section scripts{
    <script>
        $(document).ready(function () {
            $("#tableStats").bootstrapTable();
            //RankingFormatter();
        });
        function callChangefunc(val) {
            window.location.href = "/MotoStats/holeshotStats?selectedSeasonId=" + val;
        }
        function RankingFormatterNbTimesGood(value, row) {
            var color = "badge-light";
            if (value >= 7)
                color = "badge-verygood";
            else if (value >= 5)
                color = "badge-good";
            return '<span class="badge ' + color + '" >' + value + '</span>';
        }
        function RankingFormatterNbTimesBad(value, row) {
            var color = "badge-light";
            if (value >= 5)
                color = "badge-verybad";
            else if (value >= 3)
                color = "badge-bad";
            return '<span class="badge ' + color + '" >' + value + '</span>';
        }
        function RankingFormatter(value, row) {
            var color = "badge-light";
            if (value <= - 6)
                color = "badge-verybad";
            else if (value <= 0)
                color = "badge-bad";
            else if (value >= 7)
                color = "badge-good";
            else if (value >= 4)
                color = "badge-verygood";
            return '<span class="badge '+color+'" >' + value + '</span>';
        }
        function FormatGridRk(value, row) {
            return '<span class="badge badge-light" >' + value + '</span>'
        }
        function FormatLapRk(value, row) {
            var progression = 0;
            var color = "badge-light";
            switch (this.field) {
                case 'lap1':
                    progression = row.grid - row.lap1;
                    break;
                case 'lap2':
                    progression = row.lap1 - row.lap2;
                    break;
                case 'lap5':
                    progression = row.lap2 - row.lap5;
                    break;
                case 'lap10':
                    progression = row.lap5 - row.lap10;
                    break;
                default:
            }
            switch (value) {
                case "1":
                case "2":
                case "3":
                    color = "badge-warning";
                    break;
                case "4":
                case "5":
                case "6":
                    color = "badge-primary";
                    break;
                default:
            }
            if (progression > 0) {
                return '<span class="badge ' + color+'" >' + value + '</span>' + addIcons(progression, 1);
            }
            else if (progression < 0) {
                return '<span class="badge ' + color +'" >' + value + '</span>' + addIcons(progression, 1);
            }
            else return '<span class="badge ' + color +'" >' + value + '</span>';
        }
        /**
         * Returns html code with as many icons as progression value
         * Icon will be different if the progression is positive or negative  
         * @@param { number } progression number of positions won
         */
        function addIcons(progression, nbMaxIcons) {
            icon = "";
            if (progression > 0) {
                icon = ' <img src="/img/green-arrow-up-16.png" width="16" height="16"></img >';
            }
            else if (progression < 0) {
                icon = ' <img src="/img/red-arrow-down-16.png" width="16" height="16"></img >';
            }
            else return "";
            var listicons = "";
            for (var i = 0; i < Math.min(nbMaxIcons, Math.abs(progression)/2); i++) {
                listicons += icon;
            }
            return listicons;
        }
    </script>
}
<h2>MotoGP Stats - Race Stats</h2>
<div class="row">
    Season Average rankings for&nbsp;<text class="font-weight-bold">Grid&nbsp;</text> and end of each <text class="font-weight-bold">&nbsp;Lap&nbsp;</text>.
</div>
<div class="row">
    Number of times the rider won/lost 2(or more) positions between Grid and end of Lap 1
</div>
<hr />
<div class="row">
    @Html.DropDownListFor(model => model.SelectedSeasonId, new SelectList(Model.Seasons, "SeasonId", "Label"), "--select season--"
           , new { @onchange = "callChangefunc(this.value)", @class = "custom-select" })
</div>
<div class="row mt-1">
    <div class="col-sm-10">
        <!--class="table table-striped table-hover table-sm table-condensed sortable">-->
        <div class="table-responsive">
            <table id="tableStats" data-toggle="table"
                   data-pagination="true" data-page-size="15" data-page-list="[15, All]" data-locale="en-US"
                   class="table table-striped table-hover table-sm" data-detail-view="true">
                <thead>
                    <tr>
                        <th colspan="5">Avg Position at the end of each lap</th>
                        <th colspan="4">2 or + positions gained/lost in Lap 1 (number of times)</th>
                    </tr>
                    <tr class="thead-light">
                        <th data-field="grid" data-sortable="true" data-formatter="FormatGridRk">Grid</th>
                        <th data-field="lap1" data-sortable="true" data-formatter="FormatLapRk">Lap1</th>
                        <th data-field="lap2" data-sortable="true" data-formatter="FormatLapRk">Lap2</th>
                        <th data-field="lap5" data-sortable="true" data-formatter="FormatLapRk">Lap5</th>
                        <th data-field="lap10" data-sortable="true" data-formatter="FormatLapRk">Lap10</th>
                        <th data-sortable="true" class="font-weight-bold">Rider</th>
                        <th data-field="rankPlus2" data-sortable="true" data-formatter="RankingFormatterNbTimesGood">+2 Pos</th>
                        <th data-field="rankMinus2" data-sortable="true" data-formatter="RankingFormatterNbTimesBad">-2 Pos</th>
                        <th data-field="diffRanksWonLost" data-sortable="true" data-formatter="RankingFormatter" class="font-weight-bold">Diff</th>

                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.RiderStatsForStart)
                    {
                        <tr>
                            <td>
                                @Html.DisplayFor(p => item.AvgGridRank)
                            </td>
                            <td>
                                @Html.DisplayFor(p => item.AvgLap1Rank)
                            </td>
                            <td>
                                @Html.DisplayFor(p => item.AvgLap2Rank)
                            </td>
                            <td>
                                @Html.DisplayFor(p => item.AvgLap5Rank)
                            </td>
                            <td>
                                @Html.DisplayFor(p => item.AvgLap10Rank)
                            </td>
                            <td>
                                @Html.DisplayFor(p => item.RiderName)
                            </td>
                            <td>
                                @Html.DisplayFor(p => item.NbTimes2RkWonAfterLap1)
                            </td>
                            <td>
                                @Html.DisplayFor(p => item.NbTimes2RkLostAfterLap1)
                            </td>
                            <td>
                                @Html.DisplayFor(p => item.Diff2RkWonLostAfterLap1)
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="small font-italic"></div>
        <div class="small font-italic"></div>
    </div>
</div>
<div class="small font-italic">ONLY Race 1 (Race part 2 not included in case of restarts)</div>
